<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LangGraph Plugin Example - DataPrism</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .panel {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f9f9f9;
        }
        
        .workflow-definition {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            overflow-x: auto;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.created { background: #e3f2fd; color: #1976d2; }
        .status.running { background: #fff3e0; color: #f57c00; }
        .status.completed { background: #e8f5e8; color: #388e3c; }
        .status.failed { background: #ffebee; color: #d32f2f; }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .metric {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }
        
        .metric-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        button {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #1565c0;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .agent-card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 5px 0;
            background: white;
        }
        
        .agent-name {
            font-weight: bold;
            color: #1976d2;
        }
        
        .agent-spec {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>üîó LangGraph Plugin - Workflow Orchestration</h1>
    <p>This example demonstrates the LangGraph plugin's capability to create and execute graph-based analytical workflows with multiple specialized agents.</p>
    
    <div class="container">
        <div class="panel">
            <h3>üìä Workflow Control</h3>
            
            <div>
                <h4>Sample Data Analysis Workflow</h4>
                <div class="workflow-definition" id="workflowDef">
                    Loading workflow definition...
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <button onclick="createWorkflow()" id="createBtn">Create Workflow</button>
                <button onclick="executeWorkflow()" id="executeBtn" disabled>Execute Workflow</button>
                <button onclick="pauseWorkflow()" id="pauseBtn" disabled>Pause</button>
                <button onclick="resumeWorkflow()" id="resumeBtn" disabled>Resume</button>
                <button onclick="stopWorkflow()" id="stopBtn" disabled>Stop</button>
            </div>
            
            <div>
                <h4>Workflow Status</h4>
                <div id="workflowStatus" class="status created">Not Created</div>
                
                <div class="metrics" id="metrics">
                    <div class="metric">
                        <div class="metric-value" id="totalNodes">0</div>
                        <div class="metric-label">Total Nodes</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="completedNodes">0</div>
                        <div class="metric-label">Completed</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="executionTime">0s</div>
                        <div class="metric-label">Execution Time</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="agentCalls">0</div>
                        <div class="metric-label">Agent Calls</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="panel">
            <h3>ü§ñ Registered Agents</h3>
            <div id="agentsList">
                Loading agents...
            </div>
            
            <h3>üìù Execution Log</h3>
            <div id="log" class="log">
                [INFO] LangGraph Plugin loaded successfully
                [INFO] Ready to create workflows...
            </div>
        </div>
    </div>

    <script type="module">
        // Mock DataPrism plugin system for demo
        let plugin = null;
        let currentWorkflow = null;
        let workflowId = 'demo-workflow';
        let executionStartTime = null;
        
        // Sample workflow definition
        const sampleWorkflow = {
            id: 'data-analysis-workflow',
            name: 'Comprehensive Data Analysis',
            description: 'Multi-agent workflow for comprehensive data analysis',
            version: '1.0.0',
            nodes: [
                {
                    id: 'data-discovery',
                    type: 'agent',
                    name: 'Data Discovery',
                    agentId: 'data-discovery-agent',
                    configuration: {
                        analysisDepth: 'comprehensive',
                        includeQualityMetrics: true
                    }
                },
                {
                    id: 'statistical-analysis',
                    type: 'agent',
                    name: 'Statistical Analysis',
                    agentId: 'statistical-analysis-agent',
                    configuration: {
                        methods: ['descriptive', 'correlation', 'distribution']
                    }
                },
                {
                    id: 'insight-generation',
                    type: 'agent',
                    name: 'Insight Generation',
                    agentId: 'insight-generation-agent',
                    configuration: {
                        focusAreas: ['patterns', 'anomalies', 'trends']
                    }
                },
                {
                    id: 'report-generation',
                    type: 'agent',
                    name: 'Report Generation',
                    agentId: 'report-generation-agent',
                    configuration: {
                        format: 'comprehensive',
                        includeVisualizations: true
                    }
                }
            ],
            edges: [
                { from: 'data-discovery', to: 'statistical-analysis' },
                { from: 'statistical-analysis', to: 'insight-generation' },
                { from: 'insight-generation', to: 'report-generation' }
            ],
            entryPoint: 'data-discovery'
        };
        
        // Mock agents for demo
        const mockAgents = [
            {
                id: 'data-discovery-agent',
                name: 'Data Discovery Specialist',
                specialization: 'data-discovery',
                description: 'Analyzes dataset structure, types, and quality',
                llmProvider: 'openai',
                model: 'gpt-4'
            },
            {
                id: 'statistical-analysis-agent',
                name: 'Statistical Analyst',
                specialization: 'statistical-analysis',
                description: 'Performs statistical analysis and correlation studies',
                llmProvider: 'openai',
                model: 'gpt-4'
            },
            {
                id: 'insight-generation-agent',
                name: 'Insight Generator',
                specialization: 'insight-generation',
                description: 'Generates business insights from analytical results',
                llmProvider: 'anthropic',
                model: 'claude-3-sonnet'
            },
            {
                id: 'report-generation-agent',
                name: 'Report Writer',
                specialization: 'insight-generation',
                description: 'Creates comprehensive analytical reports',
                llmProvider: 'openai',
                model: 'gpt-4'
            }
        ];
        
        // Initialize demo
        window.addEventListener('DOMContentLoaded', () => {
            displayWorkflowDefinition();
            displayAgents();
            logMessage('INFO', 'Demo initialized successfully');
            logMessage('INFO', 'Sample workflow loaded with 4 agents');
        });
        
        function displayWorkflowDefinition() {
            const defElement = document.getElementById('workflowDef');
            defElement.textContent = JSON.stringify(sampleWorkflow, null, 2);
        }
        
        function displayAgents() {
            const agentsElement = document.getElementById('agentsList');
            agentsElement.innerHTML = mockAgents.map(agent => `
                <div class="agent-card">
                    <div class="agent-name">${agent.name}</div>
                    <div class="agent-spec">${agent.specialization} ‚Ä¢ ${agent.llmProvider}:${agent.model}</div>
                    <div style="font-size: 12px; margin-top: 5px;">${agent.description}</div>
                </div>
            `).join('');
        }
        
        function logMessage(level, message) {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            log.textContent += `[${timestamp}] [${level}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        function updateStatus(status) {
            const statusElement = document.getElementById('workflowStatus');
            statusElement.textContent = status;
            statusElement.className = `status ${status.toLowerCase()}`;
        }
        
        function updateMetrics(metrics) {
            if (metrics.totalNodes !== undefined) {
                document.getElementById('totalNodes').textContent = metrics.totalNodes;
            }
            if (metrics.completedNodes !== undefined) {
                document.getElementById('completedNodes').textContent = metrics.completedNodes;
            }
            if (metrics.executionTime !== undefined) {
                document.getElementById('executionTime').textContent = metrics.executionTime;
            }
            if (metrics.agentCalls !== undefined) {
                document.getElementById('agentCalls').textContent = metrics.agentCalls;
            }
        }
        
        function updateButtons(state) {
            const buttons = {
                createBtn: document.getElementById('createBtn'),
                executeBtn: document.getElementById('executeBtn'),
                pauseBtn: document.getElementById('pauseBtn'),
                resumeBtn: document.getElementById('resumeBtn'),
                stopBtn: document.getElementById('stopBtn')
            };
            
            // Reset all buttons
            Object.values(buttons).forEach(btn => btn.disabled = true);
            
            switch (state) {
                case 'initial':
                    buttons.createBtn.disabled = false;
                    break;
                case 'created':
                    buttons.executeBtn.disabled = false;
                    break;
                case 'running':
                    buttons.pauseBtn.disabled = false;
                    buttons.stopBtn.disabled = false;
                    break;
                case 'paused':
                    buttons.resumeBtn.disabled = false;
                    buttons.stopBtn.disabled = false;
                    break;
                case 'completed':
                case 'failed':
                case 'stopped':
                    buttons.createBtn.disabled = false;
                    break;
            }
        }
        
        // Demo workflow functions
        window.createWorkflow = async function() {
            logMessage('INFO', 'Creating workflow...');
            updateStatus('Creating');
            
            // Simulate workflow creation
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            currentWorkflow = { ...sampleWorkflow };
            updateStatus('Created');
            updateMetrics({
                totalNodes: sampleWorkflow.nodes.length,
                completedNodes: 0,
                executionTime: '0s',
                agentCalls: 0
            });
            updateButtons('created');
            
            logMessage('INFO', `Workflow "${sampleWorkflow.name}" created successfully`);
            logMessage('INFO', `Workflow has ${sampleWorkflow.nodes.length} nodes`);
        };
        
        window.executeWorkflow = async function() {
            if (!currentWorkflow) return;
            
            logMessage('INFO', 'Starting workflow execution...');
            updateStatus('Running');
            updateButtons('running');
            executionStartTime = Date.now();
            
            const nodes = currentWorkflow.nodes;
            let agentCallCount = 0;
            
            for (let i = 0; i < nodes.length; i++) {
                const node = nodes[i];
                logMessage('INFO', `Executing node: ${node.name} (${node.agentId})`);
                
                // Simulate agent execution
                const executionTime = Math.random() * 3000 + 1000; // 1-4 seconds
                await new Promise(resolve => setTimeout(resolve, executionTime));
                
                agentCallCount++;
                const completedNodes = i + 1;
                const elapsed = Math.round((Date.now() - executionStartTime) / 1000);
                
                updateMetrics({
                    completedNodes,
                    executionTime: `${elapsed}s`,
                    agentCalls: agentCallCount
                });
                
                logMessage('INFO', `Node "${node.name}" completed successfully`);
                
                // Simulate some analysis results
                if (node.type === 'agent') {
                    const results = generateMockResults(node);
                    logMessage('DEBUG', `Agent output: ${results}`);
                }
            }
            
            updateStatus('Completed');
            updateButtons('completed');
            
            const totalTime = Math.round((Date.now() - executionStartTime) / 1000);
            logMessage('INFO', `Workflow execution completed in ${totalTime}s`);
            logMessage('INFO', 'All analysis results available for review');
        };
        
        window.pauseWorkflow = function() {
            logMessage('INFO', 'Workflow paused');
            updateStatus('Paused');
            updateButtons('paused');
        };
        
        window.resumeWorkflow = function() {
            logMessage('INFO', 'Workflow resumed');
            updateStatus('Running');
            updateButtons('running');
        };
        
        window.stopWorkflow = function() {
            logMessage('INFO', 'Workflow stopped');
            updateStatus('Stopped');
            updateButtons('stopped');
        };
        
        function generateMockResults(node) {
            const results = {
                'data-discovery': 'Schema: 5 columns, 1000 rows. Quality score: 92%',
                'statistical-analysis': 'Mean: 45.2, StdDev: 12.8, Correlation: 0.73',
                'insight-generation': 'Key insight: Strong positive trend in Q3 data',
                'report-generation': 'Report generated with 3 charts and executive summary'
            };
            
            return results[node.agentId.replace('-agent', '')] || 'Analysis completed';
        }
        
        // Initialize
        updateButtons('initial');
    </script>
</body>
</html>